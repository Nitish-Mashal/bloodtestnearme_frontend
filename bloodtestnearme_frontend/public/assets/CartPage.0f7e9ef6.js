var E=(z,v,k)=>new Promise((S,C)=>{var w=c=>{try{l(k.next(c))}catch(p){C(p)}},x=c=>{try{l(k.throw(c))}catch(p){C(p)}},l=c=>c.done?S(c.value):Promise.resolve(c.value).then(w,x);l((k=k.apply(z,v)).next())});import{r as f,b as Y,w as M,z as ne,A as H,f as i,g as d,N as re,h as t,i as K,j as ie,q as N,F as j,m as q,k as de,l as h,v as D,t as u,p as g,y as F,Q as L,n as V,R as ue,e as ce}from"./vendor.489ad559.js";import{u as me,a as ve}from"./index.4f0f76dd.js";import pe from"./MostBookedHealthCheckups.ee6695f0.js";const ge={key:0,class:"flex justify-center items-center h-60"},be={key:1},fe={class:"container"},xe={class:"py-4 row"},ye={class:"col-12 col-md-6 mb-2"},he={class:"flex justify-between items-center mb-4"},_e={key:0},ke={class:"font-semibold text-[#001D55]"},we={class:"text-gray-500"},Se={class:"line-through"},Ce={class:"font-semibold text-[#001D55] ml-1"},Pe=["onClick"],Ie={key:1,class:"text-gray-500"},$e={class:"col-12 col-md-6"},Ne={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},De={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},Me={class:"relative w-full min-h-[40px]"},Ve={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},Ae=["disabled"],Te=["value"],Oe={key:0,class:"text-sm font-semibold mb-2 mt-2"},Re=["onUpdate:modelValue","onInput"],Ue={key:1,class:"text-xs text-red-500 mt-1"},Be={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ee=["onUpdate:modelValue","onInput"],He={key:0,class:"text-xs text-red-500 mt-1"},je=["onUpdate:modelValue","onChange"],qe={key:0,class:"text-xs text-red-500 mt-1"},Fe={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Le={key:0,class:"text-xs text-red-500 mt-1"},ze={key:0,class:"text-xs text-red-500 mt-1"},Je={key:0,class:"text-xs text-red-500 mt-1"},Ge={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Qe=["min"],Ze={key:0,class:"text-xs text-red-500 mt-1"},Ye=["disabled"],Ke=["value"],We={key:0,class:"text-xs text-red-500 mt-1"},Xe={class:"flex items-center text-sm text-gray-700"},et={class:"mt-3"},tt={key:0},lt={key:1},st={class:"mt-2 text-lg font-semibold text-[#001D55]"},at={class:"flex justify-center"},ot=["disabled"],nt={key:0,class:"mt-3 text-center"},rt=300,W=200,X=75,pt={__name:"CartPage",setup(z){const v=me(),k=f(!0),S=f(!1),C=f(!1),w=f(""),x=f([{name:"",age:"",gender:""}]),l=f({}),c=f({text:"",type:""}),p=f(""),y=f(""),o=f({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),U=Y(()=>v.cartItems.reduce((a,e)=>a+Number(e.discounted_price||0),0)),J=Y(()=>{let a=U.value;return a<rt&&(a+=W),o.value.printedReports&&(a+=X),Math.round(a)}),G=f(0);M(J,a=>G.value=a,{immediate:!0}),M(w,a=>{const e=Number(a);x.value=Array.from({length:e||1},()=>({name:"",age:"",gender:""}))}),M(x,a=>{a.forEach((e,r)=>{e.name=e.name.replace(/[^a-zA-Z\s]/g,""),["name","age","gender"].forEach(s=>{e[s]&&delete l.value[`${s}_${r}`]})})},{deep:!0});const A=f([]),ee=f(new Date().toISOString().split("T")[0]),Q=(()=>{const a=[],e=new Date;e.setHours(7,0,0,0);const r=new Date;for(r.setHours(18,0,0,0);e<r;){const s=new Date(e.getTime()+30*6e4),n=m=>m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});a.push(`${n(e)} - ${n(s)}`),e.setTime(s.getTime())}return a})();M(()=>o.value.date,a=>{if(!a){A.value=[],o.value.timeSlot="";return}const e=new Date(a),r=new Date;if(e.toDateString()===r.toDateString()){const n=new Date;A.value=Q.filter(m=>{const[P]=m.split(" - "),[I,_]=P.split(" ");let[b,B]=I.split(":").map(Number);_==="PM"&&b!==12&&(b+=12),_==="AM"&&b===12&&(b=0);const O=new Date;return O.setHours(b,B,0,0),O>n})}else A.value=[...Q];o.value.timeSlot=""});const te=a=>{const r=a.target.value.replace(/\D/g,"");o.value.pincode=r,r?r.length<6?(l.value.pincode="Pincode must be 6 digits.",p.value="",y.value=""):r.length>6?(l.value.pincode="Pincode cannot exceed 6 digits.",p.value="",y.value="error"):(delete l.value.pincode,p.value="",y.value=""):(l.value.pincode="Please enter pincode.",p.value="",y.value="")},le=a=>{const e=a.target.value;o.value.address=e;const r=e.trim();r?r.length<25?l.value.address="Address must be at least 25 characters.":delete l.value.address:l.value.address="Please enter your address."};M(()=>o.value.email,a=>{const e=a.trim();e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?delete l.value.email:l.value.email="Please enter a valid email address (example@domain.com).":l.value.email="Please enter your email."}),M(()=>o.value.mobile,a=>{const e=a.trim();e?/^[6-9]\d{9}$/.test(e)?delete l.value.mobile:l.value.mobile="Please enter a valid Indian mobile number.":l.value.mobile="Please enter your mobile number."});const se=a=>{const e=a.target.value.replace(/\D/g,"");o.value.mobile=e,e?/^[6-9]\d{0,9}$/.test(e)?e.length>10?l.value.mobile="Mobile number cannot exceed 10 digits.":e.length<10?l.value.mobile="Mobile number must be 10 digits.":delete l.value.mobile:l.value.mobile="Please enter a valid Indian mobile number.":l.value.mobile="Please enter your mobile number."},T=a=>delete l.value[a],ae=()=>{var n,m,P,I;l.value={};const a=o.value,e=(n=a.pincode)==null?void 0:n.trim();e?/^\d{6}$/.test(e)||(l.value.pincode="Pincode must be 6 digits."):l.value.pincode="Please enter pincode.",x.value.forEach((_,b)=>{_.name?/^[A-Za-z\s]+$/.test(_.name)||(l.value[`name_${b}`]="Name must contain only letters."):l.value[`name_${b}`]="Name is required.",_.age||(l.value[`age_${b}`]="Age is required."),_.gender||(l.value[`gender_${b}`]="Gender is required.")}),a.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(l.value.email="Invalid email address."):l.value.email="Please enter your email.";const r=(m=a.mobile)==null?void 0:m.trim();r?/^[6-9]\d{9}$/.test(r)||(l.value.mobile="Invalid Indian mobile number."):l.value.mobile="Please enter your mobile number.";const s=(P=a.address)==null?void 0:P.trim();return s?s.length<25&&(l.value.address="Address must be at least 25 characters."):l.value.address="Please enter your address.",a.date||(l.value.date="Please select date."),a.timeSlot||(l.value.timeSlot="Please select time slot."),((I=v.cartItems)==null?void 0:I.length)||(c.value={text:"No items in cart to book.",type:"error"}),!Object.keys(l.value).length&&(!c.value.text||c.value.type!=="error")},Z=()=>E(this,null,function*(){var e,r;const a=o.value.pincode.trim();if(p.value="",y.value="",!/^\d{6}$/.test(a)){p.value="Enter valid 6 digit pincode first.",y.value="error";return}C.value=!0;try{const{data:s}=yield H.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:a}}),n=s==null?void 0:s.message;p.value=(n==null?void 0:n.message)||"Response received",y.value=(n==null?void 0:n.status)||"success"}catch(s){console.error("Error checking pincode:",s),p.value=((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Unable to check availability.",y.value="error"}finally{C.value=!1}}),oe=()=>E(this,null,function*(){var s,n,m,P,I,_,b,B,O;if(c.value={text:"",type:""},!ae()){c.value={text:"Please fix the errors above.",type:"error"};return}if(y.value!=="success"&&(yield Z(),y.value!=="success")){c.value={text:p.value||"Home collection not available for this pincode.",type:"error"};return}const a=ve();a.loadScannedId();const e=a.scannedId,r={customer_name:((s=x.value[0])==null?void 0:s.name)||"",age:((n=x.value[0])==null?void 0:n.age)||"",gender:((m=x.value[0])==null?void 0:m.gender)||"",email:o.value.email,mobile_number:o.value.mobile,address:o.value.address,pincode:o.value.pincode,appointment_date:o.value.date,appointment_time:o.value.timeSlot,number_of_persons:Number(w.value)||x.value.length||1,hard_copy_required:o.value.printedReports?1:0,total_price:G.value,total_item_price:U.value,ordered_items:JSON.parse(JSON.stringify(v.cartItems)),customer_details:JSON.parse(JSON.stringify(x.value)),home_collection:o.value.homeCollection?1:0};e&&(r.affiliated_id=e,console.log("\u{1F4E6} Including affiliated_id in payload:",e)),S.value=!0,k.value=!0;try{const $=yield H.post("/api/method/bloodtestnearme.api.order_api.create_order",r),R=(_=(I=(P=$.data)==null?void 0:P.message)!=null?I:$.data)!=null?_:{};R.status==="success"?(c.value={text:R.successmessage||"Your order is submitted successfully",type:"success"},o.value={pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1},w.value="",x.value=[{name:"",age:"",gender:""}],l.value={},(b=v.clearCart)==null||b.call(v)):c.value={text:(R==null?void 0:R.message)||"Failed to create order.",type:"error"}}catch($){console.error("Order creation error:",$),c.value={text:((O=(B=$==null?void 0:$.response)==null?void 0:B.data)==null?void 0:O.message)||"Server error occurred.",type:"error"}}finally{S.value=!1,k.value=!1}});return ne(()=>E(this,null,function*(){try{yield Promise.all([H.get("/api/method/bloodtestnearme.api.packages.get_individual_packages"),H.get("/api/method/bloodtestnearme.api.packages.get_package_based_tests")])}catch(a){console.error("Error fetching packages:",a)}finally{k.value=!1}})),(a,e)=>{const r=ce("router-link");return k.value?(i(),d("div",ge,[...e[10]||(e[10]=[re('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading cart details...</p></div>',1)])])):(i(),d("div",be,[t("div",fe,[t("div",xe,[t("div",ye,[t("div",he,[e[12]||(e[12]=t("h5",{class:"text-[#001D55] font-semibold"},"Cart Items",-1)),K(r,{to:"/blood-test-online-bangalore",class:"flex items-center text-red-700 font-medium no-underline hover:underline-offset-2"},{default:ie(()=>[...e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 mr-1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})],-1),V(" Add more tests ",-1)])]),_:1})]),e[13]||(e[13]=t("hr",{class:"border-gray-300 mb-3"},null,-1)),N(v).cartItems&&N(v).cartItems.length?(i(),d("div",_e,[(i(!0),d(j,null,q(N(v).cartItems,(s,n)=>(i(),d("div",{key:n,class:"flex justify-between items-center mb-3 rounded-lg"},[t("div",null,[t("h6",ke,u(s.name1),1),t("div",we,[t("span",Se,"\u20B9 "+u(s.actual_price),1),t("span",Ce,"\u20B9 "+u(s.discounted_price),1)])]),t("button",{onClick:m=>N(v).removeFromCart(s.name1),class:"bg-[#0040BB] text-white px-4 py-2 rounded-full hover:bg-[#002F8E] transition"}," Remove ",8,Pe)]))),128))])):(i(),d("p",Ie,"No items in the cart."))]),t("div",$e,[t("div",Ne,[t("form",{class:"space-y-2 bold-test-color",onSubmit:de(oe,["prevent"])},[t("div",De,[t("div",Me,[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.pincode=s),onInput:te,type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[D,o.value.pincode]]),l.value.pincode?(i(),d("p",Ve,u(l.value.pincode),1)):g("",!0),p.value?(i(),d("p",{key:1,class:F(["absolute text-[11px] mt-[2px]",y.value==="success"?"text-green-600":"text-red-500"])},u(p.value),3)):g("",!0)]),t("button",{type:"button",onClick:Z,disabled:C.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},u(C.value?"Checking...":"Check Availability"),9,Ae)]),t("div",null,[h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[14]||(e[14]=t("option",{disabled:"",value:""},"Select Number of Person *",-1)),(i(),d(j,null,q(10,s=>t("option",{key:s,value:s},u(s),9,Te)),64))],512),[[L,w.value]]),e[16]||(e[16]=t("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests will be added for all persons. ",-1)),(i(!0),d(j,null,q(x.value,(s,n)=>(i(),d("div",{key:n,class:"border p-1 rounded-md bg-gray-50 mb-2"},[w.value&&w.value>1?(i(),d("h6",Oe," Person "+u(n+1),1)):g("",!0),h(t("input",{"onUpdate:modelValue":m=>s.name=m,onInput:m=>T(`name_${n}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,Re),[[D,s.name]]),l.value[`name_${n}`]?(i(),d("p",Ue,u(l.value[`name_${n}`]),1)):g("",!0),t("div",Be,[t("div",null,[h(t("input",{"onUpdate:modelValue":m=>s.age=m,onInput:m=>T(`age_${n}`),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Ee),[[D,s.age]]),l.value[`age_${n}`]?(i(),d("p",He,u(l.value[`age_${n}`]),1)):g("",!0)]),t("div",null,[h(t("select",{"onUpdate:modelValue":m=>s.gender=m,onChange:m=>T(`gender_${n}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[15]||(e[15]=[t("option",{disabled:"",value:""},"Select Gender *",-1),t("option",null,"Male",-1),t("option",null,"Female",-1),t("option",null,"Others",-1)])],40,je),[[L,s.gender]]),l.value[`gender_${n}`]?(i(),d("p",qe,u(l.value[`gender_${n}`]),1)):g("",!0)])])]))),128))]),t("div",Fe,[t("div",null,[h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.email=s),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,512),[[D,o.value.email]]),l.value.email?(i(),d("p",Le,u(l.value.email),1)):g("",!0)]),t("div",null,[h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.mobile=s),onInput:se,type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full",maxlength:"10",inputmode:"numeric"},null,544),[[D,o.value.mobile]]),l.value.mobile?(i(),d("p",ze,u(l.value.mobile),1)):g("",!0)])]),t("div",null,[h(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.address=s),onInput:le,rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[D,o.value.address]]),l.value.address?(i(),d("p",Je,u(l.value.address),1)):g("",!0)]),e[23]||(e[23]=t("div",{class:"flex items-center justify-center gap-2"},[t("span",{class:"font-semibold text-sm"},"Collection Type:"),t("label",{class:"flex items-center gap-2 text-sm cursor-not-allowed"},[t("input",{type:"checkbox",checked:"",disabled:"",class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"}),V(" Home Collection ")])],-1)),t("div",Ge,[t("div",null,[h(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.date=s),onChange:e[6]||(e[6]=s=>T("date")),min:ee.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Qe),[[D,o.value.date]]),l.value.date?(i(),d("p",Ze,u(l.value.date),1)):g("",!0)]),t("div",null,[h(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.timeSlot=s),onChange:e[8]||(e[8]=s=>T("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!A.value.length},[e[17]||(e[17]=t("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(i(!0),d(j,null,q(A.value,(s,n)=>(i(),d("option",{key:n,value:s},u(s),9,Ke))),128))],40,Ye),[[L,o.value.timeSlot]]),l.value.timeSlot?(i(),d("p",We,u(l.value.timeSlot),1)):g("",!0)])]),t("div",null,[t("div",Xe,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>o.value.printedReports=s),class:"mr-2"},null,512),[[ue,o.value.printedReports]]),e[18]||(e[18]=t("span",{class:"text-red-500"},"Additional Rs. 75 for Printed Reports",-1))]),t("div",et,[t("p",null,[e[19]||(e[19]=t("strong",null,"Test/Package Price:",-1)),V(" \u20B9"+u(U.value),1)]),N(v).cartItems.length>0&&U.value<300?(i(),d("p",tt,[e[20]||(e[20]=t("strong",null,"Home Collection Charge:",-1)),V(" \u20B9"+u(W))])):g("",!0),o.value.printedReports?(i(),d("p",lt,[e[21]||(e[21]=t("strong",null,"Printed Report Charge:",-1)),V(" \u20B9"+u(X))])):g("",!0),t("p",st,[e[22]||(e[22]=t("strong",null,"Total Amount:",-1)),V(" \u20B9"+u(J.value),1)])])]),t("div",at,[t("button",{type:"submit",disabled:N(v).cartItems.length===0||S.value,class:F(["px-20 py-2 rounded-full transition w-full sm:w-auto",N(v).cartItems.length===0||S.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"global-bg-color text-white"])},u(S.value?"Booking...":"Book Now"),11,ot)]),c.value.text?(i(),d("div",nt,[t("p",{class:F(c.value.type==="success"?"text-green-600":"text-red-600")},u(c.value.text),3)])):g("",!0)],32)])])])]),K(pe)]))}}};export{pt as default};
