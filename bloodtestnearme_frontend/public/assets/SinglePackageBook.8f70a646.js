var E=(j,M,m)=>new Promise((C,$)=>{var x=c=>{try{P(m.next(c))}catch(y){$(y)}},b=c=>{try{P(m.throw(c))}catch(y){$(y)}},P=c=>c.done?C(c.value):Promise.resolve(c.value).then(x,b);P((m=m.apply(j,M)).next())});import{u as de,r as g,w as R,z as ie,b as ue,f as i,g as u,N as ce,h as a,t as r,k as me,l as h,v as I,p as f,y as pe,Q as L,F,m as z,n as N,R as ve,i as ge,A as B}from"./vendor.489ad559.js";import{a as fe}from"./index.4f0f76dd.js";import be from"./MostBookedHealthCheckups.ee6695f0.js";const ye={key:0,class:"flex justify-center items-center h-60"},he={key:1},xe={class:"container"},_e={class:"py-4 row"},ke={class:"col-12 col-md-6 mb-2"},we={class:"bold-test-color pb-2"},Se={class:"bold-test-color"},Pe=["innerHTML"],Ce={class:"pt-4"},$e={class:"text-red-600"},Ae={class:"col-12 col-md-6"},Ie={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},Me={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},Re={class:"relative w-full min-h-[40px]"},Te={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},Ve=["disabled"],De=["value"],Ne={key:0,class:"text-sm font-semibold mb-2 mt-2"},Ue=["onUpdate:modelValue","onInput"],Ee={key:1,class:"text-xs text-red-500 mt-1"},Be={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},He=["onUpdate:modelValue","onInput"],Oe={key:0,class:"text-xs text-red-500 mt-1"},Le=["onUpdate:modelValue","onChange"],Fe={key:0,class:"text-xs text-red-500 mt-1"},ze={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},je={key:0,class:"text-xs text-red-500 mt-1"},qe={key:0,class:"text-xs text-red-500 mt-1"},Ye={key:0,class:"text-xs text-red-500 mt-1"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ge=["min"],Je={key:0,class:"text-xs text-red-500 mt-1"},Qe=["disabled"],Ke=["value"],We={key:0,class:"text-xs text-red-500 mt-1"},Xe={class:"flex items-center text-sm text-gray-700"},et={class:"mt-3"},tt={key:0},at={key:1},st={class:"mt-2 text-lg font-semibold text-[#001D55]"},lt={key:0,class:"mt-3 text-center"},ot={class:"text-green-600"},ct={__name:"SinglePackageBook",setup(j){const M=de();decodeURIComponent(M.params.slug);const m=g({}),C=g(!0),$=g(0),x=g(""),b=g(""),P=g(!1),c=g(""),y=g(""),_=g([{name:"",age:"",gender:""}]);R(y,s=>{const e=Number(s);if(!e){_.value=[{name:"",age:"",gender:""}];return}_.value=Array.from({length:e},()=>({name:"",age:"",gender:""}))});const o=g({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),l=g({}),T=g([]),te=new Date().toISOString().split("T")[0],ae=g(te),U=g(200),q=g(75),Y=(()=>{const s=[],e=new Date;e.setHours(7,0,0,0);const t=new Date;for(t.setHours(18,0,0,0);e<t;){const n=new Date(e.getTime()+30*6e4),d=p=>p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});s.push(`${d(e)} - ${d(n)}`),e.setTime(n.getTime())}return s})();R(()=>o.value.date,s=>{if(!s){T.value=[],o.value.timeSlot="";return}const e=new Date(s),t=new Date;if(e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()){const n=new Date;T.value=Y.filter(d=>{const p=new Date,[v]=d.split(" - "),[k,w]=v.split(" ");let[S,V]=k.split(":").map(Number);return w==="PM"&&S!==12&&(S+=12),w==="AM"&&S===12&&(S=0),p.setHours(S,V,0,0),p>n})}else T.value=[...Y];o.value.timeSlot=""});const se=()=>E(this,null,function*(){var s,e,t;C.value=!0;try{const n=M.params.url||M.params.slug||M.params.id;if(n)try{const v=(s=(yield B.get("/api/method/bloodtestnearme.api.packages.get_packages",{params:{url:decodeURIComponent(n)}})).data)==null?void 0:s.message,k=Array.isArray(v==null?void 0:v.data)&&v.data.length?v.data[0]:(v==null?void 0:v.data)||v;if(k){m.value=k,$.value=parseFloat(k.discounted_price||0)+U.value,Z(k);return}else console.warn("\u26A0\uFE0F No data found using URL param:",n)}catch(p){console.warn("\u26A0\uFE0F URL-based API failed, falling back to full fetch.")}const d=["/api/method/bloodtestnearme.api.packages.get_package_based_tests","/api/method/bloodtestnearme.api.packages.get_individual_packages"];for(const p of d){const w=(((t=(e=(yield B.get(p)).data)==null?void 0:e.message)==null?void 0:t.data)||[]).find(S=>{var D;return((D=S.name1)==null?void 0:D.toLowerCase().replace(/\s+/g,"-"))===(n==null?void 0:n.toLowerCase())});if(w){m.value=w,$.value=parseFloat(w.discounted_price||0)+U.value,Z(w);break}}}catch(n){console.error("\u274C Error fetching package details:",n)}finally{C.value=!1}}),Z=s=>{document.title=s.title||s.package_name||s.name1||"Blood Test Near Me - Health Packages";let e=document.querySelector("meta[name='description']");e||(e=document.createElement("meta"),e.name="description",document.head.appendChild(e)),e.setAttribute("content",s.meta_description||s.short_description||`Book ${s.package_name||"this health checkup"} at home easily with Blood Test Near Me.`),H("og:title",s.meta_title||s.package_name),H("og:description",s.meta_description),H("og:type","website")},H=(s,e)=>{if(!e)return;let t=document.querySelector(`meta[property='${s}']`);t||(t=document.createElement("meta"),t.setAttribute("property",s),document.head.appendChild(t)),t.setAttribute("content",e)},le=()=>E(this,null,function*(){var t,n,d,p,v,k,w,S,V,D,Q;if(c.value="",l.value={},!re()){c.value="Please fix the highlighted errors before submitting.";return}if(!(b.value==="success"||(yield G(!0)))){c.value="Please enter a valid pincode before booking.";return}C.value=!0;try{const A=fe();A.loadScannedId();const K=A.scannedId;let W={customer_name:((t=_.value[0])==null?void 0:t.name)||"",age:((n=_.value[0])==null?void 0:n.age)||"",gender:((d=_.value[0])==null?void 0:d.gender)||"",email:o.value.email,mobile_number:o.value.mobile,address:o.value.address,pincode:o.value.pincode,appointment_date:o.value.date,appointment_time:o.value.timeSlot,number_of_persons:y.value||1,hard_copy_required:o.value.printedReports?1:0,total_price:$.value,total_item_price:m.value.discounted_price,ordered_items:[m.value],customer_details:_.value};K&&(W.affiliated_id=K);const X=JSON.parse(JSON.stringify(W));console.log("Payload:",X);const ee=yield B.post("/api/method/bloodtestnearme.api.order_api.create_order",X),O=(k=(v=(p=ee.data)==null?void 0:p.message)!=null?v:ee.data)!=null?k:{};O.status==="success"?(c.value=O.successmessage||"Your order is submitted successfully",o.value={pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1},y.value="",_.value=[{name:"",age:"",gender:""}],x.value="",b.value="",setTimeout(()=>c.value="",3e3)):c.value=O.message||"Failed to create order. Please try again."}catch(A){console.error("API ERROR:",((w=A.response)==null?void 0:w.data)||A),c.value=((V=(S=A.response)==null?void 0:S.data)==null?void 0:V.message)||((Q=(D=A.response)==null?void 0:D.data)==null?void 0:Q.exc)||"Server error occurred."}finally{C.value=!1}}),G=(s=!1)=>E(this,null,function*(){var t,n;const e=(t=o.value.pincode)==null?void 0:t.trim();if(!e&&s)return l.value.pincode="Please enter your pincode before booking.",!1;if(!/^\d{6}$/.test(e))return l.value.pincode="Pincode must be 6 digits.",!1;x.value="",b.value="",P.value=!0;try{const p=(n=(yield B.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:e}})).data)==null?void 0:n.message;p?(x.value=p.message||"",b.value=p.status||"error"):(x.value="Unexpected API response format.",b.value="error")}catch(d){console.error("Error checking pincode:",d),x.value="Unable to check availability at the moment.",b.value="error"}finally{P.value=!1}return b.value==="success"});ie(se),R(()=>o.value.pincode,s=>{const e=s.replace(/\D/g,"");s!==e&&(o.value.pincode=e),x.value="",b.value="",e?e.length!==6?l.value.pincode="Pincode must be 6 digits.":delete l.value.pincode:l.value.pincode="Please enter pincode."}),R(()=>o.value.email,s=>{s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?delete l.value.email:l.value.email="Please enter a valid email address (example@domain.com).":l.value.email="Please enter your email."});const oe=s=>{let e=s.target.value.replace(/\D/g,"");e.length>10&&(e=e.slice(0,10)),o.value.mobile=e,e?/^[6-9]/.test(e)?e.length<10?l.value.mobile="Mobile number must be exactly 10 digits.":delete l.value.mobile:l.value.mobile="Please enter a valid Indian mobile number.":l.value.mobile="Please enter your mobile number."},ne=s=>{const e=s.target.value;o.value.address=e,e.trim()?e.trim().length<25?l.value.address="Address must be at least 25 characters long.":delete l.value.address:l.value.address="Please enter your address."};R(_,s=>{s.forEach((e,t)=>{e.name&&/[^a-zA-Z\s]/.test(e.name)&&(e.name=e.name.replace(/[^a-zA-Z\s]/g,"")),e.name&&delete l.value[`name_${t}`],e.age&&delete l.value[`age_${t}`],e.gender&&delete l.value[`gender_${t}`]})},{deep:!0});const re=()=>{l.value={},o.value.pincode?/^\d{6}$/.test(o.value.pincode)||(l.value.pincode="Pincode must be 6 digits."):l.value.pincode="Please enter pincode.",_.value.forEach((t,n)=>{t.name?/^[A-Za-z\s]+$/.test(t.name)||(l.value[`name_${n}`]="Name must contain only letters."):l.value[`name_${n}`]="Name is required.",t.age||(l.value[`age_${n}`]="Age is required."),t.gender||(l.value[`gender_${n}`]="Gender is required.")}),o.value.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value.email)||(l.value.email="Please enter a valid email address."):l.value.email="Please enter your email.";const s=o.value.mobile.trim();s?/^[6-9]\d{9}$/.test(s)||(l.value.mobile="Invalid Indian mobile number."):l.value.mobile="Please enter your mobile number.";const e=o.value.address.trim();return e?e.length<25&&(l.value.address="Address must be at least 25 characters."):l.value.address="Please enter your address.",o.value.date||(l.value.date="Please select your date."),o.value.timeSlot||(l.value.timeSlot="Please select your time slot."),Object.keys(l.value).length===0},J=ue(()=>{const s=parseFloat(m.value.discounted_price||0);let e=s;return s<300&&(e+=U.value),o.value.printedReports&&(e+=q.value),e});return R(J,s=>$.value=s),(s,e)=>C.value?(i(),u("div",ye,[...e[12]||(e[12]=[ce('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading package details...</p></div>',1)])])):(i(),u("div",he,[a("div",xe,[a("div",_e,[a("div",ke,[a("h4",we,r(m.value.name1)+" ("+r(m.value.number_of_test)+" Tests) ",1),a("div",Se,[a("div",{class:"pt-2",innerHTML:m.value.description},null,8,Pe),a("div",Ce,[e[13]||(e[13]=a("strong",null,"Sample Type: ",-1)),a("span",$e,r(m.value.sample_type),1)])])]),a("div",Ae,[a("div",Ie,[a("form",{onSubmit:me(le,["prevent"]),class:"space-y-2 bold-test-color"},[a("div",Me,[a("div",Re,[h(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.pincode=t),onInput:e[1]||(e[1]=t=>s.clearError("pincode")),type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[I,o.value.pincode]]),l.value.pincode?(i(),u("p",Te,r(l.value.pincode),1)):f("",!0),x.value?(i(),u("p",{key:1,class:pe(["absolute text-[11px] mt-[2px]",b.value==="success"?"text-green-600":"text-red-500"])},r(x.value),3)):f("",!0)]),a("button",{type:"button",onClick:G,disabled:P.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},r(P.value?"Checking...":"Check Availability"),9,Ve)]),a("div",null,[h(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[14]||(e[14]=a("option",{disabled:"",value:""},"Select Number of Person *",-1)),(i(),u(F,null,z(10,t=>a("option",{key:t,value:t},r(t),9,De)),64))],512),[[L,y.value]]),e[16]||(e[16]=a("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests/packages will be added for all persons. ",-1)),(i(!0),u(F,null,z(_.value,(t,n)=>(i(),u("div",{key:n,class:"border p-1 rounded-md bg-gray-50 mb-2"},[y.value&&y.value>1?(i(),u("h6",Ne," Person "+r(n+1),1)):f("",!0),h(a("input",{"onUpdate:modelValue":d=>t.name=d,onInput:d=>s.clearError(`name_${n}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,Ue),[[I,t.name]]),l.value[`name_${n}`]?(i(),u("p",Ee,r(l.value[`name_${n}`]),1)):f("",!0),a("div",Be,[a("div",null,[h(a("input",{"onUpdate:modelValue":d=>t.age=d,onInput:d=>s.clearError(`age_${n}`),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,He),[[I,t.age]]),l.value[`age_${n}`]?(i(),u("p",Oe,r(l.value[`age_${n}`]),1)):f("",!0)]),a("div",null,[h(a("select",{"onUpdate:modelValue":d=>t.gender=d,onChange:d=>s.clearError(`gender_${n}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[15]||(e[15]=[a("option",{disabled:"",value:""},"Select Gender *",-1),a("option",null,"Male",-1),a("option",null,"Female",-1),a("option",null,"Others",-1)])],40,Le),[[L,t.gender]]),l.value[`gender_${n}`]?(i(),u("p",Fe,r(l.value[`gender_${n}`]),1)):f("",!0)])])]))),128))]),a("div",ze,[a("div",null,[h(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.email=t),onInput:e[4]||(e[4]=t=>s.clearError("email")),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[I,o.value.email]]),l.value.email?(i(),u("p",je,r(l.value.email),1)):f("",!0)]),a("div",null,[h(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.mobile=t),onInput:oe,type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[I,o.value.mobile]]),l.value.mobile?(i(),u("p",qe,r(l.value.mobile),1)):f("",!0)])]),a("div",null,[h(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.address=t),onInput:ne,rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[I,o.value.address]]),l.value.address?(i(),u("p",Ye,r(l.value.address),1)):f("",!0)]),e[23]||(e[23]=a("div",{class:"flex items-center justify-center gap-2"},[a("span",{class:"font-semibold text-sm"},"Collection Type:"),a("label",{class:"flex items-center gap-2 text-sm cursor-not-allowed"},[a("input",{type:"checkbox",checked:"",disabled:"",class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"}),N(" Home Collection ")])],-1)),a("div",Ze,[a("div",null,[h(a("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.date=t),onChange:e[8]||(e[8]=t=>s.clearError("date")),min:ae.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Ge),[[I,o.value.date]]),l.value.date?(i(),u("p",Je,r(l.value.date),1)):f("",!0)]),a("div",null,[h(a("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.timeSlot=t),onChange:e[10]||(e[10]=t=>s.clearError("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!T.value.length},[e[17]||(e[17]=a("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(i(!0),u(F,null,z(T.value,(t,n)=>(i(),u("option",{key:n,value:t},r(t),9,Ke))),128))],40,Qe),[[L,o.value.timeSlot]]),l.value.timeSlot?(i(),u("p",We,r(l.value.timeSlot),1)):f("",!0)])]),a("div",null,[a("div",Xe,[h(a("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>o.value.printedReports=t),id:"printedReports",class:"mr-2"},null,512),[[ve,o.value.printedReports]]),e[18]||(e[18]=a("label",{for:"printedReports",class:"text-red-500"}," Additional Rs. 75 for Printed Reports ",-1))]),a("div",et,[a("p",null,[e[19]||(e[19]=a("strong",null,"Test/Package Price:",-1)),N(" \u20B9"+r(m.value.discounted_price),1)]),m.value.discounted_price<300?(i(),u("p",tt,[e[20]||(e[20]=a("strong",null,"Home Collection Charge:",-1)),N(" \u20B9"+r(U.value),1)])):f("",!0),o.value.printedReports?(i(),u("p",at,[e[21]||(e[21]=a("strong",null,"Printed Report Charge:",-1)),N(" \u20B9"+r(q.value),1)])):f("",!0),a("p",st,[e[22]||(e[22]=a("strong",null,"Total Amount:",-1)),N(" \u20B9"+r(J.value),1)])])]),e[24]||(e[24]=a("div",{class:"flex justify-center"},[a("button",{type:"submit",class:"global-bg-color text-white px-20 py-2 rounded-full hover:bg-blue-700 transition w-full sm:w-auto"}," Book Now ")],-1)),c.value?(i(),u("div",lt,[a("p",ot,r(c.value),1)])):f("",!0)],32)])])])]),ge(be)]))}};export{ct as default};
