var T=(O,v,_)=>new Promise((w,C)=>{var k=m=>{try{o(_.next(m))}catch(h){C(h)}},f=m=>{try{o(_.throw(m))}catch(h){C(h)}},o=m=>m.done?w(m.value):Promise.resolve(m.value).then(k,f);o((_=_.apply(O,v)).next())});import{r as x,b as Z,w as U,A as se,f as r,g as i,z as le,h as t,i as Q,j as oe,q as P,F as B,m as R,k as ae,l as y,v as D,t as d,p as g,y as j,P as H,Q as Y,n as M,e as ne}from"./vendor.9d58089e.js";import{a as E}from"./axios.044e98f9.js";import re from"./MostBookedHealthCheckups.bd7f8245.js";import{u as ie}from"./index.d368a197.js";const de={key:0,class:"flex justify-center items-center h-60"},ue={key:1},me={class:"container"},ce={class:"px-5 py-4 row"},pe={class:"col-12 col-md-6 mb-2"},ve={class:"flex justify-between items-center mb-4"},ge={key:0},be={class:"font-semibold text-[#001D55]"},xe={class:"text-gray-500"},fe={class:"line-through"},ye={class:"font-semibold text-[#001D55] ml-1"},he=["onClick"],_e={key:1,class:"text-gray-500"},ke={class:"col-12 col-md-6"},we={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},Ce={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},Se={class:"relative w-full min-h-[40px]"},Ie={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},$e=["disabled"],Pe=["value"],De={key:0,class:"text-sm font-semibold mb-2 mt-2"},Ve=["onUpdate:modelValue","onInput"],Me={key:1,class:"text-xs text-red-500 mt-1"},Ne={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ae=["onUpdate:modelValue","onInput"],Te={key:0,class:"text-xs text-red-500 mt-1"},Ue=["onUpdate:modelValue","onChange"],Be={key:0,class:"text-xs text-red-500 mt-1"},Re={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ee={key:0,class:"text-xs text-red-500 mt-1"},je={key:0,class:"text-xs text-red-500 mt-1"},He={key:0,class:"text-xs text-red-500 mt-1"},Oe={class:"flex items-center justify-center gap-2"},Fe={class:"flex items-center gap-2 text-sm cursor-pointer"},Le={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},qe=["min"],ze={key:0,class:"text-xs text-red-500 mt-1"},Ge=["disabled"],Ze=["value"],Qe={key:0,class:"text-xs text-red-500 mt-1"},Ye={class:"flex items-center text-sm text-gray-700"},Je={class:"mt-3"},Ke={key:0},We={key:1},Xe={class:"mt-2 text-lg font-semibold text-[#001D55]"},et={class:"flex justify-center"},tt=["disabled"],st={key:0,class:"mt-3 text-center"},lt=300,J=200,K=75,ut={__name:"CartPage",setup(O){const v=ie(),_=x(!0),w=x(!1),C=x(!1),k=x(""),f=x([{name:"",age:"",gender:""}]),o=x({}),m=x({text:"",type:""}),h=x(""),S=x(""),n=x({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),A=Z(()=>v.cartItems.reduce((l,e)=>l+Number(e.discounted_price||0),0)),F=Z(()=>{let l=A.value;return l<lt&&(l+=J),n.value.printedReports&&(l+=K),Math.round(l)}),L=x(0);U(F,l=>L.value=l,{immediate:!0}),U(k,l=>{const e=Number(l);f.value=Array.from({length:e||1},()=>({name:"",age:"",gender:""}))}),U(f,l=>{l.forEach((e,p)=>{e.name=e.name.replace(/[^a-zA-Z\s]/g,""),["name","age","gender"].forEach(s=>{e[s]&&delete o.value[`${s}_${p}`]})})},{deep:!0});const N=x([]),W=x(new Date().toISOString().split("T")[0]),q=(()=>{const l=[],e=new Date;e.setHours(7,0,0,0);const p=new Date;for(p.setHours(18,0,0,0);e<p;){const s=new Date(e.getTime()+30*6e4),a=c=>c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});l.push(`${a(e)} - ${a(s)}`),e.setTime(s.getTime())}return l})();U(()=>n.value.date,l=>{if(!l){N.value=[],n.value.timeSlot="";return}const e=new Date(l),p=new Date;if(e.toDateString()===p.toDateString()){const a=new Date;N.value=q.filter(c=>{const[I]=c.split(" - "),[$,u]=I.split(" ");let[b,te]=$.split(":").map(Number);u==="PM"&&b!==12&&(b+=12),u==="AM"&&b===12&&(b=0);const G=new Date;return G.setHours(b,te,0,0),G>a})}else N.value=[...q];n.value.timeSlot=""});const V=l=>delete o.value[l],X=()=>{var a,c,I,$;o.value={};const l=n.value,e=(a=l.pincode)==null?void 0:a.trim();e?/^\d{6}$/.test(e)||(o.value.pincode="Pincode must be 6 digits."):o.value.pincode="Please enter pincode.",f.value.forEach((u,b)=>{u.name?/^[A-Za-z\s]+$/.test(u.name)||(o.value[`name_${b}`]="Name must contain only letters."):o.value[`name_${b}`]="Name is required.",u.age||(o.value[`age_${b}`]="Age is required."),u.gender||(o.value[`gender_${b}`]="Gender is required.")}),l.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||(o.value.email="Invalid email address."):o.value.email="Please enter your email.";const p=(c=l.mobile)==null?void 0:c.trim();p?/^[6-9]\d{9}$/.test(p)||(o.value.mobile="Invalid Indian mobile number."):o.value.mobile="Please enter your mobile number.";const s=(I=l.address)==null?void 0:I.trim();return s?s.length<25&&(o.value.address="Address must be at least 25 characters."):o.value.address="Please enter your address.",l.date||(o.value.date="Please select date."),l.timeSlot||(o.value.timeSlot="Please select time slot."),(($=v.cartItems)==null?void 0:$.length)||(m.value={text:"No items in cart to book.",type:"error"}),!Object.keys(o.value).length&&(!m.value.text||m.value.type!=="error")},z=()=>T(this,null,function*(){var e,p;const l=n.value.pincode.trim();if(h.value="",S.value="",!/^\d{6}$/.test(l)){h.value="Enter valid 6 digit pincode first.",S.value="error";return}C.value=!0;try{const{data:s}=yield E.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:l}}),a=s==null?void 0:s.message;h.value=(a==null?void 0:a.message)||"Response received",S.value=(a==null?void 0:a.status)||"success"}catch(s){console.error("Error checking pincode:",s),h.value=((p=(e=s.response)==null?void 0:e.data)==null?void 0:p.message)||"Unable to check availability.",S.value="error"}finally{C.value=!1}}),ee=()=>T(this,null,function*(){var e,p,s,a,c,I,$;if(m.value={text:"",type:""},!X()){m.value={text:"Please fix the errors above.",type:"error"};return}if(S.value!=="success"&&(yield z(),S.value!=="success")){m.value={text:h.value||"Home collection not available for this pincode.",type:"error"};return}const l={customer_name:((e=f.value[0])==null?void 0:e.name)||"",age:((p=f.value[0])==null?void 0:p.age)||"",gender:((s=f.value[0])==null?void 0:s.gender)||"",email:n.value.email,mobile_number:n.value.mobile,address:n.value.address,pincode:n.value.pincode,appointment_date:n.value.date,appointment_time:n.value.timeSlot,number_of_persons:Number(k.value)||f.value.length||1,hard_copy_required:n.value.printedReports?1:0,total_price:L.value,total_item_price:A.value,ordered_items:[...v.cartItems],customer_details:f.value,home_collection:n.value.homeCollection?1:0};w.value=!0,_.value=!0;try{const{data:u}=yield E.post("/api/method/bloodtestnearme.api.order_api.create_order",l),b=(u==null?void 0:u.status)==="success"||((a=u==null?void 0:u.message)==null?void 0:a.status)==="success";m.value=b?{text:"Your order is submitted successfully.",type:"success"}:{text:(u==null?void 0:u.message)||"Failed to create order.",type:"error"},b&&(n.value={pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1},k.value="",f.value=[{name:"",age:"",gender:""}],o.value={},(c=v.clearCart)==null||c.call(v))}catch(u){console.error("Order creation error:",u),m.value={text:(($=(I=u.response)==null?void 0:I.data)==null?void 0:$.message)||"Server error occurred.",type:"error"}}finally{w.value=!1,_.value=!1}});return se(()=>T(this,null,function*(){try{yield Promise.all([E.get("/api/method/bloodtestnearme.api.packages.get_individual_packages"),E.get("/api/method/bloodtestnearme.api.packages.get_package_based_tests")])}catch(l){console.error("Error fetching packages:",l)}finally{_.value=!1}})),(l,e)=>{const p=ne("router-link");return _.value?(r(),i("div",de,[...e[15]||(e[15]=[le('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading cart details...</p></div>',1)])])):(r(),i("div",ue,[t("div",me,[t("div",ce,[t("div",pe,[t("div",ve,[e[17]||(e[17]=t("h5",{class:"text-[#001D55] font-semibold"},"Cart Items",-1)),Q(p,{to:"/blood-test-online-bangalore",class:"flex items-center text-red-700 font-medium no-underline hover:underline-offset-2"},{default:oe(()=>[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 mr-1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})],-1),M(" Add more tests ",-1)])]),_:1})]),e[18]||(e[18]=t("hr",{class:"border-gray-300 mb-3"},null,-1)),P(v).cartItems&&P(v).cartItems.length?(r(),i("div",ge,[(r(!0),i(B,null,R(P(v).cartItems,(s,a)=>(r(),i("div",{key:a,class:"flex justify-between items-center mb-3 rounded-lg"},[t("div",null,[t("h6",be,d(s.name1),1),t("div",xe,[t("span",fe,"\u20B9 "+d(s.actual_price),1),t("span",ye,"\u20B9 "+d(s.discounted_price),1)])]),t("button",{onClick:c=>P(v).removeFromCart(s.name1),class:"bg-[#0040BB] text-white px-4 py-2 rounded-full hover:bg-[#002F8E] transition"}," Remove ",8,he)]))),128))])):(r(),i("p",_e,"No items in the cart."))]),t("div",ke,[t("div",we,[t("form",{class:"space-y-2 bold-test-color",onSubmit:ae(ee,["prevent"])},[t("div",Ce,[t("div",Se,[y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.pincode=s),onInput:e[1]||(e[1]=(...s)=>l.onPincodeInput&&l.onPincodeInput(...s)),type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[D,n.value.pincode]]),o.value.pincode?(r(),i("p",Ie,d(o.value.pincode),1)):g("",!0),h.value?(r(),i("p",{key:1,class:j(["absolute text-[11px] mt-[2px]",S.value==="success"?"text-green-600":"text-red-500"])},d(h.value),3)):g("",!0)]),t("button",{type:"button",onClick:z,disabled:C.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},d(C.value?"Checking...":"Check Availability"),9,$e)]),t("div",null,[y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[19]||(e[19]=t("option",{disabled:"",value:""},"Select Number of Person *",-1)),(r(),i(B,null,R(10,s=>t("option",{key:s,value:s},d(s),9,Pe)),64))],512),[[H,k.value]]),e[21]||(e[21]=t("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests will be added for all persons. ",-1)),(r(!0),i(B,null,R(f.value,(s,a)=>(r(),i("div",{key:a,class:"border p-1 rounded-md bg-gray-50 mb-2"},[k.value&&k.value>1?(r(),i("h6",De," Person "+d(a+1),1)):g("",!0),y(t("input",{"onUpdate:modelValue":c=>s.name=c,onInput:c=>V(`name_${a}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,Ve),[[D,s.name]]),o.value[`name_${a}`]?(r(),i("p",Me,d(o.value[`name_${a}`]),1)):g("",!0),t("div",Ne,[t("div",null,[y(t("input",{"onUpdate:modelValue":c=>s.age=c,onInput:c=>V(`age_${a}`),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Ae),[[D,s.age]]),o.value[`age_${a}`]?(r(),i("p",Te,d(o.value[`age_${a}`]),1)):g("",!0)]),t("div",null,[y(t("select",{"onUpdate:modelValue":c=>s.gender=c,onChange:c=>V(`gender_${a}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[20]||(e[20]=[t("option",{disabled:"",value:""},"Select Gender *",-1),t("option",null,"Male",-1),t("option",null,"Female",-1),t("option",null,"Others",-1)])],40,Ue),[[H,s.gender]]),o.value[`gender_${a}`]?(r(),i("p",Be,d(o.value[`gender_${a}`]),1)):g("",!0)])])]))),128))]),t("div",Re,[t("div",null,[y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.email=s),onInput:e[4]||(e[4]=s=>V("email")),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[D,n.value.email]]),o.value.email?(r(),i("p",Ee,d(o.value.email),1)):g("",!0)]),t("div",null,[y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.mobile=s),onInput:e[6]||(e[6]=(...s)=>l.onMobileInput&&l.onMobileInput(...s)),type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[D,n.value.mobile]]),o.value.mobile?(r(),i("p",je,d(o.value.mobile),1)):g("",!0)])]),t("div",null,[y(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.address=s),onInput:e[8]||(e[8]=(...s)=>l.onAddressInput&&l.onAddressInput(...s)),rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[D,n.value.address]]),o.value.address?(r(),i("p",He,d(o.value.address),1)):g("",!0)]),t("div",Oe,[e[23]||(e[23]=t("span",{class:"font-semibold text-sm"},"Collection Type:",-1)),t("label",Fe,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>n.value.homeCollection=s),class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"},null,512),[[Y,n.value.homeCollection]]),e[22]||(e[22]=M(" Home Collection ",-1))])]),t("div",Le,[t("div",null,[y(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.date=s),onChange:e[11]||(e[11]=s=>V("date")),min:W.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,qe),[[D,n.value.date]]),o.value.date?(r(),i("p",ze,d(o.value.date),1)):g("",!0)]),t("div",null,[y(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>n.value.timeSlot=s),onChange:e[13]||(e[13]=s=>V("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!N.value.length},[e[24]||(e[24]=t("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(r(!0),i(B,null,R(N.value,(s,a)=>(r(),i("option",{key:a,value:s},d(s),9,Ze))),128))],40,Ge),[[H,n.value.timeSlot]]),o.value.timeSlot?(r(),i("p",Qe,d(o.value.timeSlot),1)):g("",!0)])]),t("div",null,[t("div",Ye,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=s=>n.value.printedReports=s),class:"mr-2"},null,512),[[Y,n.value.printedReports]]),e[25]||(e[25]=t("span",{class:"text-red-500"},"Additional Rs. 75 for Printed Reports",-1))]),t("div",Je,[t("p",null,[e[26]||(e[26]=t("strong",null,"Test/Package Price:",-1)),M(" \u20B9"+d(A.value),1)]),P(v).cartItems.length>0&&A.value<300?(r(),i("p",Ke,[e[27]||(e[27]=t("strong",null,"Home Collection Charge:",-1)),M(" \u20B9"+d(J))])):g("",!0),n.value.printedReports?(r(),i("p",We,[e[28]||(e[28]=t("strong",null,"Printed Report Charge:",-1)),M(" \u20B9"+d(K))])):g("",!0),t("p",Xe,[e[29]||(e[29]=t("strong",null,"Total Amount:",-1)),M(" \u20B9"+d(F.value),1)])])]),t("div",et,[t("button",{type:"submit",disabled:P(v).cartItems.length===0||w.value,class:j(["px-20 py-2 rounded-full transition w-full sm:w-auto",P(v).cartItems.length===0||w.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"global-bg-color text-white"])},d(w.value?"Booking...":"Book Now"),11,tt)]),m.value.text?(r(),i("div",st,[t("p",{class:j(m.value.type==="success"?"text-green-600":"text-red-600")},d(m.value.text),3)])):g("",!0)],32)])])])]),Q(re)]))}}};export{ut as default};
