var E=(F,I,m)=>new Promise(($,C)=>{var x=c=>{try{P(m.next(c))}catch(h){C(h)}},y=c=>{try{P(m.throw(c))}catch(h){C(h)}},P=c=>c.done?$(c.value):Promise.resolve(c.value).then(x,y);P((m=m.apply(F,I)).next())});import{u as de,r as g,w as M,e as ue,b as ce,g as d,h as u,N as me,i as l,t as r,m as pe,n as _,v as N,j as f,z as ve,a5 as L,F as j,p as q,q as R,a6 as ge,k as fe,A as B}from"./vendor.f066bd90.js";import{a as be}from"./index.7675e28a.js";import ye from"./MostBookedHealthCheckups.f9345828.js";import"./carousel.d1a52f45.js";const he={key:0,class:"flex justify-center items-center h-60"},_e={key:1},xe={class:"container"},ke={class:"py-4 row"},we={class:"col-12 col-md-6 mb-2"},Se={class:"bold-test-color pb-2"},Pe={class:"bold-test-color"},$e=["innerHTML"],Ce={class:"pt-4"},Ae={class:"text-red-600"},Ne={class:"col-12 col-md-6"},Ie={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},Me={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},Te={class:"relative w-full min-h-[40px]"},Ve={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},De=["disabled"],Re=["value"],Ue={key:0,class:"text-sm font-semibold mb-2 mt-2"},Ee=["onUpdate:modelValue","onInput"],Be={key:1,class:"text-xs text-red-500 mt-1"},He={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Oe=["onUpdate:modelValue","onInput"],Le={key:0,class:"text-xs text-red-500 mt-1"},je=["onUpdate:modelValue","onChange"],qe={key:0,class:"text-xs text-red-500 mt-1"},Fe={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},ze={key:0,class:"text-xs text-red-500 mt-1"},Ye={key:0,class:"text-xs text-red-500 mt-1"},Ze={key:0,class:"text-xs text-red-500 mt-1"},Ge={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Je=["min"],Qe={key:0,class:"text-xs text-red-500 mt-1"},Ke=["disabled"],We=["value"],Xe={key:0,class:"text-xs text-red-500 mt-1"},et={class:"flex items-center text-sm text-gray-700"},tt={class:"mt-3"},at={key:0},lt={key:1},st={class:"mt-2 text-lg font-semibold text-[#001D55]"},ot={key:0,class:"mt-3 text-center"},nt={class:"text-green-600"},pt={__name:"SinglePackageBook",setup(F){const I=de();decodeURIComponent(I.params.slug);const m=g({}),$=g(!0),C=g(0),x=g(""),y=g(""),P=g(!1),c=g(""),h=g(""),b=g([{name:"",age:"",gender:""}]);M(h,a=>{const e=Number(a);if(!e){b.value=[{name:"",age:"",gender:""}];return}b.value=Array.from({length:e},()=>({name:"",age:"",gender:""}))});const o=g({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),s=g({}),T=g([]),te=new Date().toISOString().split("T")[0],ae=g(te),U=g(200),z=g(75),Y=(()=>{const a=[],e=new Date;e.setHours(7,0,0,0);const t=new Date;for(t.setHours(18,0,0,0);e<t;){const n=new Date(e.getTime()+30*6e4),i=p=>p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});a.push(`${i(e)} - ${i(n)}`),e.setTime(n.getTime())}return a})();M(()=>o.value.date,a=>{if(!a){T.value=[],o.value.timeSlot="";return}const e=new Date(a),t=new Date;if(e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()){const n=new Date;T.value=Y.filter(i=>{const p=new Date,[v]=i.split(" - "),[k,w]=v.split(" ");let[S,V]=k.split(":").map(Number);return w==="PM"&&S!==12&&(S+=12),w==="AM"&&S===12&&(S=0),p.setHours(S,V,0,0),p>n})}else T.value=[...Y];o.value.timeSlot=""});const le=()=>E(this,null,function*(){var a,e,t;$.value=!0;try{const n=I.params.url||I.params.slug||I.params.id;if(n)try{const v=(a=(yield B.get("/api/method/bloodtestnearme.api.packages.get_packages",{params:{url:decodeURIComponent(n)}})).data)==null?void 0:a.message,k=Array.isArray(v==null?void 0:v.data)&&v.data.length?v.data[0]:(v==null?void 0:v.data)||v;if(k){m.value=k,C.value=parseFloat(k.discounted_price||0)+U.value,Z(k);return}else console.warn("\u26A0\uFE0F No data found using URL param:",n)}catch(p){console.warn("\u26A0\uFE0F URL-based API failed, falling back to full fetch.")}const i=["/api/method/bloodtestnearme.api.packages.get_package_based_tests","/api/method/bloodtestnearme.api.packages.get_individual_packages"];for(const p of i){const w=(((t=(e=(yield B.get(p)).data)==null?void 0:e.message)==null?void 0:t.data)||[]).find(S=>{var D;return((D=S.name1)==null?void 0:D.toLowerCase().replace(/\s+/g,"-"))===(n==null?void 0:n.toLowerCase())});if(w){m.value=w,C.value=parseFloat(w.discounted_price||0)+U.value,Z(w);break}}}catch(n){console.error("\u274C Error fetching package details:",n)}finally{$.value=!1}}),Z=a=>{document.title=a.title||a.package_name||a.name1||"Blood Test Near Me - Health Packages";let e=document.querySelector("meta[name='description']");e||(e=document.createElement("meta"),e.name="description",document.head.appendChild(e)),e.setAttribute("content",a.meta_description||a.short_description||`Book ${a.package_name||"this health checkup"} at home easily with Blood Test Near Me.`),H("og:title",a.meta_title||a.package_name),H("og:description",a.meta_description),H("og:type","website")},H=(a,e)=>{if(!e)return;let t=document.querySelector(`meta[property='${a}']`);t||(t=document.createElement("meta"),t.setAttribute("property",a),document.head.appendChild(t)),t.setAttribute("content",e)},se=()=>E(this,null,function*(){var t,n,i,p,v,k,w,S,V,D,Q;if(c.value="",s.value={},!ie()){c.value="Please fix the highlighted errors before submitting.";return}if(!(y.value==="success"||(yield G(!0)))){c.value="Please enter a valid pincode before booking.";return}$.value=!0;try{const A=be();A.loadScannedId();const K=A.scannedId;let W={customer_name:((t=b.value[0])==null?void 0:t.name)||"",age:((n=b.value[0])==null?void 0:n.age)||"",gender:((i=b.value[0])==null?void 0:i.gender)||"",email:o.value.email,mobile_number:o.value.mobile,address:o.value.address,pincode:o.value.pincode,appointment_date:o.value.date,appointment_time:o.value.timeSlot,number_of_persons:h.value||1,hard_copy_required:o.value.printedReports?1:0,total_price:C.value,total_item_price:m.value.discounted_price,ordered_items:[m.value],customer_details:b.value};K&&(W.affiliated_id=K);const X=JSON.parse(JSON.stringify(W));console.log("Payload:",X);const ee=yield B.post("/api/method/bloodtestnearme.api.order_api.create_order",X),O=(k=(v=(p=ee.data)==null?void 0:p.message)!=null?v:ee.data)!=null?k:{};O.status==="success"?(c.value=O.successmessage||"Your order is submitted successfully",o.value={pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1},h.value="",b.value=[{name:"",age:"",gender:""}],x.value="",y.value="",setTimeout(()=>c.value="",3e3)):c.value=O.message||"Failed to create order. Please try again."}catch(A){console.error("API ERROR:",((w=A.response)==null?void 0:w.data)||A),c.value=((V=(S=A.response)==null?void 0:S.data)==null?void 0:V.message)||((Q=(D=A.response)==null?void 0:D.data)==null?void 0:Q.exc)||"Server error occurred."}finally{$.value=!1}}),G=(a=!1)=>E(this,null,function*(){var t,n;const e=(t=o.value.pincode)==null?void 0:t.trim();if(!e&&a)return s.value.pincode="Please enter your pincode before booking.",!1;if(!/^\d{6}$/.test(e))return s.value.pincode="Pincode must be 6 digits.",!1;x.value="",y.value="",P.value=!0;try{const p=(n=(yield B.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:e}})).data)==null?void 0:n.message;p?(x.value=p.message||"",y.value=p.status||"error"):(x.value="Unexpected API response format.",y.value="error")}catch(i){console.error("Error checking pincode:",i),x.value="Unable to check availability at the moment.",y.value="error"}finally{P.value=!1}return y.value==="success"});ue(le),M(()=>o.value.pincode,a=>{const e=a.replace(/\D/g,"");a!==e&&(o.value.pincode=e),x.value="",y.value="",e?e.length!==6?s.value.pincode="Pincode must be 6 digits.":delete s.value.pincode:s.value.pincode="Please enter pincode."}),M(()=>o.value.email,a=>{a?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?delete s.value.email:s.value.email="Please enter a valid email address (example@domain.com).":s.value.email="Please enter your email."});const oe=a=>{let e=a.target.value.replace(/\D/g,"");e.length>10&&(e=e.slice(0,10)),o.value.mobile=e,e?/^[6-9]/.test(e)?e.length<10?s.value.mobile="Mobile number must be exactly 10 digits.":delete s.value.mobile:s.value.mobile="Please enter a valid Indian mobile number.":s.value.mobile="Please enter your mobile number."},ne=a=>{const e=a.target.value;o.value.address=e,e.trim()?e.trim().length<25?s.value.address="Address must be at least 25 characters long.":delete s.value.address:s.value.address="Please enter your address."},re=a=>{let e=b.value[a].age.toString();if(e==="-"){s.value[`age_${a}`]="Negative numbers are not allowed";return}const t=Number(e);e?isNaN(t)?s.value[`age_${a}`]="Age must be a number.":t<0?(s.value[`age_${a}`]="Negative numbers are not allowed",b.value[a].age=""):t>100?s.value[`age_${a}`]="Age should be a number between 0 and 100":delete s.value[`age_${a}`]:s.value[`age_${a}`]="Age is required."};M(b,a=>{a.forEach((e,t)=>{e.name&&/[^a-zA-Z\s]/.test(e.name)&&(e.name=e.name.replace(/[^a-zA-Z\s]/g,"")),e.name&&delete s.value[`name_${t}`],e.age&&delete s.value[`age_${t}`],e.gender&&delete s.value[`gender_${t}`]})},{deep:!0});const ie=()=>{s.value={},o.value.pincode?/^\d{6}$/.test(o.value.pincode)||(s.value.pincode="Pincode must be 6 digits."):s.value.pincode="Please enter pincode.",b.value.forEach((t,n)=>{t.name?/^[A-Za-z\s]+$/.test(t.name)||(s.value[`name_${n}`]="Name must contain only letters."):s.value[`name_${n}`]="Name is required.",t.age?(t.age<0||t.age>100)&&(s.value[`age_${n}`]="Age should be a number between 0 and 100"):s.value[`age_${n}`]="Age is required.",t.gender||(s.value[`gender_${n}`]="Gender is required.")}),o.value.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value.email)||(s.value.email="Please enter a valid email address."):s.value.email="Please enter your email.";const a=o.value.mobile.trim();a?/^[6-9]\d{9}$/.test(a)||(s.value.mobile="Invalid Indian mobile number."):s.value.mobile="Please enter your mobile number.";const e=o.value.address.trim();return e?e.length<25&&(s.value.address="Address must be at least 25 characters."):s.value.address="Please enter your address.",o.value.date||(s.value.date="Please select your date."),o.value.timeSlot||(s.value.timeSlot="Please select your time slot."),Object.keys(s.value).length===0},J=ce(()=>{const a=parseFloat(m.value.discounted_price||0);let e=a;return a<300&&(e+=U.value),o.value.printedReports&&(e+=z.value),e});return M(J,a=>C.value=a),(a,e)=>$.value?(d(),u("div",he,[...e[12]||(e[12]=[me('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading package details...</p></div>',1)])])):(d(),u("div",_e,[l("div",xe,[l("div",ke,[l("div",we,[l("h4",Se,r(m.value.name1)+" ("+r(m.value.number_of_test)+" Tests) ",1),l("div",Pe,[l("div",{class:"pt-2",innerHTML:m.value.description},null,8,$e),l("div",Ce,[e[13]||(e[13]=l("strong",null,"Sample Type: ",-1)),l("span",Ae,r(m.value.sample_type),1)])])]),l("div",Ne,[l("div",Ie,[l("form",{onSubmit:pe(se,["prevent"]),class:"space-y-2 bold-test-color"},[l("div",Me,[l("div",Te,[_(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.pincode=t),onInput:e[1]||(e[1]=t=>a.clearError("pincode")),type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[N,o.value.pincode]]),s.value.pincode?(d(),u("p",Ve,r(s.value.pincode),1)):f("",!0),x.value?(d(),u("p",{key:1,class:ve(["absolute text-[11px] mt-[2px]",y.value==="success"?"text-green-600":"text-red-500"])},r(x.value),3)):f("",!0)]),l("button",{type:"button",onClick:G,disabled:P.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},r(P.value?"Checking...":"Check Availability"),9,De)]),l("div",null,[_(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[14]||(e[14]=l("option",{disabled:"",value:""},"Select Number of Person *",-1)),(d(),u(j,null,q(10,t=>l("option",{key:t,value:t},r(t),9,Re)),64))],512),[[L,h.value]]),e[16]||(e[16]=l("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests/packages will be added for all persons. ",-1)),(d(!0),u(j,null,q(b.value,(t,n)=>(d(),u("div",{key:n,class:"border p-1 rounded-md bg-gray-50 mb-2"},[h.value&&h.value>1?(d(),u("h6",Ue," Person "+r(n+1),1)):f("",!0),_(l("input",{"onUpdate:modelValue":i=>t.name=i,onInput:i=>a.clearError(`name_${n}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,Ee),[[N,t.name]]),s.value[`name_${n}`]?(d(),u("p",Be,r(s.value[`name_${n}`]),1)):f("",!0),l("div",He,[l("div",null,[_(l("input",{"onUpdate:modelValue":i=>t.age=i,onInput:i=>re(n),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Oe),[[N,t.age]]),s.value[`age_${n}`]?(d(),u("p",Le,r(s.value[`age_${n}`]),1)):f("",!0)]),l("div",null,[_(l("select",{"onUpdate:modelValue":i=>t.gender=i,onChange:i=>a.clearError(`gender_${n}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[15]||(e[15]=[l("option",{disabled:"",value:""},"Select Gender *",-1),l("option",null,"Male",-1),l("option",null,"Female",-1),l("option",null,"Others",-1)])],40,je),[[L,t.gender]]),s.value[`gender_${n}`]?(d(),u("p",qe,r(s.value[`gender_${n}`]),1)):f("",!0)])])]))),128))]),l("div",Fe,[l("div",null,[_(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.email=t),onInput:e[4]||(e[4]=t=>a.clearError("email")),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[N,o.value.email]]),s.value.email?(d(),u("p",ze,r(s.value.email),1)):f("",!0)]),l("div",null,[_(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.mobile=t),onInput:oe,type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[N,o.value.mobile]]),s.value.mobile?(d(),u("p",Ye,r(s.value.mobile),1)):f("",!0)])]),l("div",null,[_(l("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.address=t),onInput:ne,rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[N,o.value.address]]),s.value.address?(d(),u("p",Ze,r(s.value.address),1)):f("",!0)]),e[23]||(e[23]=l("div",{class:"flex items-center justify-center gap-2"},[l("span",{class:"font-semibold text-sm"},"Collection Type:"),l("label",{class:"flex items-center gap-2 text-sm cursor-not-allowed"},[l("input",{type:"checkbox",checked:"",disabled:"",class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"}),R(" Home Collection ")])],-1)),l("div",Ge,[l("div",null,[_(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.date=t),onChange:e[8]||(e[8]=t=>a.clearError("date")),min:ae.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Je),[[N,o.value.date]]),s.value.date?(d(),u("p",Qe,r(s.value.date),1)):f("",!0)]),l("div",null,[_(l("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.timeSlot=t),onChange:e[10]||(e[10]=t=>a.clearError("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!T.value.length},[e[17]||(e[17]=l("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(d(!0),u(j,null,q(T.value,(t,n)=>(d(),u("option",{key:n,value:t},r(t),9,We))),128))],40,Ke),[[L,o.value.timeSlot]]),s.value.timeSlot?(d(),u("p",Xe,r(s.value.timeSlot),1)):f("",!0)])]),l("div",null,[l("div",et,[_(l("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>o.value.printedReports=t),id:"printedReports",class:"mr-2"},null,512),[[ge,o.value.printedReports]]),e[18]||(e[18]=l("label",{for:"printedReports",class:"text-red-500"}," Additional Rs. 75 for Printed Reports ",-1))]),l("div",tt,[l("p",null,[e[19]||(e[19]=l("strong",null,"Test/Package Price:",-1)),R(" \u20B9"+r(m.value.discounted_price),1)]),m.value.discounted_price<300?(d(),u("p",at,[e[20]||(e[20]=l("strong",null,"Home Collection Charge:",-1)),R(" \u20B9"+r(U.value),1)])):f("",!0),o.value.printedReports?(d(),u("p",lt,[e[21]||(e[21]=l("strong",null,"Printed Report Charge:",-1)),R(" \u20B9"+r(z.value),1)])):f("",!0),l("p",st,[e[22]||(e[22]=l("strong",null,"Total Amount:",-1)),R(" \u20B9"+r(J.value),1)])])]),e[24]||(e[24]=l("div",{class:"flex justify-center"},[l("button",{type:"submit",class:"global-bg-color text-white px-20 py-2 rounded-full hover:bg-blue-700 transition w-full sm:w-auto"}," Book Now ")],-1)),c.value?(d(),u("div",ot,[l("p",nt,r(c.value),1)])):f("",!0)],32)])])])]),fe(ye)]))}};export{pt as default};
